<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag and Drop Quiz</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #FFFFFF;
        margin: 0;
        padding: 20px;
        text-align: center;
        box-sizing: border-box;
    }

    .container {
        max-width: 800px;
        margin: auto;
    }

    .quiz-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .column {
        width: 90%; /* Keeping it at 90% width as per your original code */
        margin: 0 auto 20px;
    }

    .phrase, .dropzone, .restart-button {
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        text-align: center;
        cursor: pointer;
        border-radius: 25px;
        box-sizing: border-box;
        width: 90%; /* Keeping it at 90% width as per your original code */
        overflow: hidden;
        display: inline-block; /* Keep elements inline-block */
    }

    .phrase {
        background-color: #9ab8fe;
        color: #fff;
        transition: transform 0.2s;
        white-space: nowrap;
        text-overflow: ellipsis;
    }

    .phrase:hover {
        transform: scale(1.05);
    }

    .phrase.hidden {
        visibility: hidden;
    }

    .dropzone {
        background-color: #e9e9e9;
        position: relative;
        padding: 10px;
        text-align: center;
        box-sizing: border-box;
        display: flex;
        flex-direction: column; /* Stack phrases vertically */
        justify-content: flex-start;
        align-items: center;
        width: 90%; /* Keep width consistent with phrases */
        min-height: 50px; /* Initial height for the drop zone */
        overflow: hidden;
        flex-grow: 1;
    }

    .dropzone .tick, .dropzone .cross {
        position: absolute;
        right: 10px;
        top: 5px;
        font-size: 24px;
        display: none;
    }

    .tick {
        color: green;
    }

    .cross {
        color: red;
    }

    .footer {
        margin-top: 20px;
        font-weight: bold;
    }

    .restart-button {
        background-color: #9ab8fe;
        color: #fff;
        border: none;
        font-size: 16px;
        transition: background-color 0.3s;
    }

    .restart-button:hover {
        background-color: #7a98dc;
    }

    .completion-image {
        width: 300px;
        margin: 20px auto;
    }

    .instructions {
        font-weight: bold;
        color: black;
        margin-bottom: 10px;
    }

    .arrow {
        font-size: 24px;
        color: black;
    }

    @media (max-width: 768px) {
        .phrase, .dropzone {
            font-size: 14px;
        }

        .dropzone {
            height: auto;
        }

        .phrase {
            max-width: 90%;
        }
    }

    .hidden {
        display: none;
    }
</style>

<script src="drag-drop-touch.esm.min.js?autoload" type="module"></script>
</head>
<body>
<div class="container">
    <h1 id="quiz-heading">Match the scenario to the most appropriate British cultural norm or phrase!</h1>

    <!-- Page 1 -->
    <div id="page1" class="quiz-container">
        <div class="instructions">Drag these <span class="arrow">↓</span></div>
        <div class="column">
            <div class="phrase" draggable="true" id="phrase1">“I’m absolutely gutted”</div>
            <div class="phrase" draggable="true" id="phrase2">Arriving on time</div>
            <div class="phrase" draggable="true" id="phrase3">“Would you mind...?”</div>
            <div class="phrase" draggable="true" id="phrase4">Using "sorry" frequently</div>
            <div class="phrase" draggable="true" id="phrase5">“I’m over the moon”</div>
        </div>
        <div class="instructions">Here <span class="arrow">↓</span></div>
        <div class="column">
            <div class="dropzone" data-correct="phrase1">
                Expression of extreme disappointment
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase5">
                Expression of extreme happiness
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase4">
                Apologizing even when it’s not your fault
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase3">
                Making a polite request
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase2">
                Being punctual for appointments or meetings
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
        </div>
        <div class="footer">0% complete</div>
    </div>

    <!-- Page 2 -->
    <div id="page2" class="quiz-container hidden">
        <div class="instructions">Drag these <span class="arrow">↓</span></div>
        <div class="column">
            <div class="phrase" draggable="true" id="phrase6">“Excuse me”</div>
            <div class="phrase" draggable="true" id="phrase7">Indirect communication</div>
            <div class="phrase" draggable="true" id="phrase8">Using "please" and "thank you"</div>
            <div class="phrase" draggable="true" id="phrase9">“Fancy meeting you here!”</div>
            <div class="phrase" draggable="true" id="phrase10">Keeping personal space</div>
        </div>
        <div class="instructions">Here <span class="arrow">↓</span></div>
        <div class="column">
            <div class="dropzone" data-correct="phrase6">
                Politely getting someone's attention
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase9">
                Expressing surprise at an unexpected meeting
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase10">
                Maintaining an arm's length distance in public places
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase7">
                Avoiding direct confrontation by using softer language
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase8">
                Demonstrating politeness in daily conversations
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
        </div>
        <div class="footer">33% complete</div>
    </div>

    <!-- Page 3 -->
    <div id="page3" class="quiz-container hidden">
        <div class="instructions">Drag these <span class="arrow">↓</span></div>
        <div class="column">
            <div class="phrase" draggable="true" id="phrase11">“I’m knackered”</div>
            <div class="phrase" draggable="true" id="phrase12">“I’m sorry” when bumping into someone</div>
            <div class="phrase" draggable="true" id="phrase13">Polite queueing</div>
            <div class="phrase" draggable="true" id="phrase14">Arriving late</div>
            <div class="phrase" draggable="true" id="phrase15">“Would you mind opening the window?”</div>
        </div>
        <div class="instructions">Here <span class="arrow">↓</span></div>
        <div class="column">
            <div class="dropzone" data-correct="phrase11">
                Expression of extreme tiredness
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase15">
                Polite request with an indirect tone
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase13">
                Waiting your turn at a public event
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase12">
                Saying "sorry" even when it's not your fault
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
            <div class="dropzone" data-correct="phrase14">
                Not following the cultural norm of punctuality
                <span class="tick">&#10004;</span>
                <span class="cross">&#10006;</span>
            </div>
        </div>
        <div class="footer">66% complete</div>
    </div>

    <!-- Completion Page -->
    <div id="completion" class="quiz-container hidden">
        <h1>Well done, you're making progress! You will be speaking like a local in no time!</h1>
        <img src="https://teacherjoe.github.io/completion-image.jpg" alt="Well Done" class="completion-image">
        <button class="restart-button" id="restart-btn">Restart Activity</button>
        <div class="footer">100% complete! Congratulations!</div>
    </div>
</div>
<audio id="applause-sound" src="applause.mp3"></audio>
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="incorrect-sound" src="incorrect.mp3"></audio>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const phrases = document.querySelectorAll('.phrase');
        const dropzones = document.querySelectorAll('.dropzone');
        const restartBtn = document.getElementById('restart-btn');

        let currentPage = 1;

        // Get audio elements
        const applauseAudio = document.getElementById("applause-sound");
        const correctAudio = document.getElementById("correct-sound");
        const incorrectAudio = document.getElementById("incorrect-sound");

        let audioUnlocked = false;  // Flag to ensure audio is unlocked after first interaction

        // Preload audio files
        applauseAudio.preload = 'auto';  // Automatically preload the audio file
        correctAudio.preload = 'auto';  // Automatically preload the audio file
        incorrectAudio.preload = 'auto';  // Automatically preload the audio file

        // Ensure that audio files load correctly
        applauseAudio.onerror = () => console.error('Error loading applause sound.');
        correctAudio.onerror = () => console.error('Error loading correct sound.');
        incorrectAudio.onerror = () => console.error('Error loading incorrect sound.');

        // Unlock audio after first user interaction (click or drag start)
        document.body.addEventListener('click', unlockAudio, { once: true });
        document.body.addEventListener('touchstart', unlockAudio, { once: true });

        function unlockAudio() {
            audioUnlocked = true;  // Allow audio to play after first interaction
        }

        phrases.forEach(phrase => {
            phrase.addEventListener('dragstart', drag);
            phrase.addEventListener('dragend', endDrag);
        });

        dropzones.forEach(zone => {
            zone.addEventListener('dragover', allowDrop);
            zone.addEventListener('drop', drop);
        });

        restartBtn.addEventListener('click', restartActivity);

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
            setTimeout(() => {
                event.target.classList.add("hidden");
            }, 0);
        }

        function endDrag(event) {
            event.target.classList.remove("hidden");
        }

        function drop(event) {
            event.preventDefault();

            // Play sound after the drop event to ensure mobile compatibility
            const data = event.dataTransfer.getData("text");
            const target = event.target;

            if (!audioUnlocked) {
                console.log("Audio is not unlocked yet.");
                return;  // Prevent audio from playing if not unlocked
            }

            if (target.classList.contains("dropzone")) {
                const phrase = document.getElementById(data);
                if (data === target.getAttribute("data-correct")) {
                    const textNode = document.createElement("p");
                    textNode.textContent = phrase.textContent;
                    target.appendChild(textNode);
                    target.querySelector(".tick").style.display = "inline";
                    target.querySelector(".cross").style.display = "none";
                    phrase.style.display = "none";
                    playSound(correctAudio);  // Play correct sound
                    checkCompletion();
                } else {
                    target.querySelector(".cross").style.display = "inline";
                    target.querySelector(".tick").style.display = "none";
                    playSound(incorrectAudio);  // Play incorrect sound
                    phrase.classList.remove("hidden");
                }
            }
        }

        // Function to play sound (from original code)
        function playSound(audio) {
            if (audioUnlocked) {
                audio.currentTime = 0;  // Rewind the sound
                audio.play().catch(err => console.error("Audio playback error:", err));
            }
        }

        function checkCompletion() {
            const pages = document.querySelectorAll(".quiz-container");
            const currentPageIndex = Array.from(pages).findIndex(page => !page.classList.contains("hidden"));
            const currentPage = pages[currentPageIndex];
            const dropzones = currentPage.querySelectorAll(".dropzone");
            const allMatched = Array.from(dropzones).every(zone => zone.querySelector("p"));

            if (allMatched) {
                if (currentPageIndex < pages.length - 2) {
                    currentPage.classList.add("hidden");
                    pages[currentPageIndex + 1].classList.remove("hidden");
                } else {
                    currentPage.classList.add("hidden");
                    document.getElementById("completion").classList.remove("hidden");
                    document.getElementById("quiz-heading").classList.add("hidden");

                    playSound(applauseAudio);  // Play applause sound when completing
                }
            }
        }

        function restartActivity() {
            document.getElementById("quiz-heading").classList.remove("hidden");
            document.getElementById("completion").classList.add("hidden");
            document.getElementById("page1").classList.remove("hidden");

            phrases.forEach(phrase => {
                phrase.style.display = "block";
                phrase.classList.remove("hidden");
            });

            dropzones.forEach(zone => {
                zone.querySelector("p")?.remove();
                zone.querySelector(".tick").style.display = "none";
                zone.querySelector(".cross").style.display = "none";
            });
        }
    });
</script>
</body>
</html>
