<script>
    document.addEventListener('DOMContentLoaded', () => {
        const phrases = document.querySelectorAll('.phrase');
        const dropzones = document.querySelectorAll('.dropzone');
        const restartBtn = document.getElementById('restart-btn');

        let currentPage = 1;

        const applauseAudio = document.getElementById("applause-sound");
        const correctAudio = document.getElementById("correct-sound");
        const incorrectAudio = document.getElementById("incorrect-sound");

        // Ensure that audio files load correctly
        applauseAudio.onerror = () => console.error('Error loading applause sound.');
        correctAudio.onerror = () => console.error('Error loading correct sound.');
        incorrectAudio.onerror = () => console.error('Error loading incorrect sound.');

        phrases.forEach(phrase => {
            phrase.addEventListener('dragstart', drag);
            phrase.addEventListener('dragend', endDrag);
        });

        dropzones.forEach(zone => {
            zone.addEventListener('dragover', allowDrop);
            zone.addEventListener('drop', drop);
        });

        restartBtn.addEventListener('click', restartActivity);

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
            setTimeout(() => {
                event.target.classList.add("hidden");
            }, 0);
        }

        function endDrag(event) {
            event.target.classList.remove("hidden");
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const target = event.target;

            if (target.classList.contains("dropzone")) {
                const phrase = document.getElementById(data);
                if (data === target.getAttribute("data-correct")) {
                    const textNode = document.createElement("p");
                    textNode.textContent = phrase.textContent;
                    target.appendChild(textNode);
                    target.querySelector(".tick").style.display = "inline";
                    target.querySelector(".cross").style.display = "none";
                    phrase.style.display = "none";
                    playSound(correctAudio);
                    checkCompletion();
                } else {
                    target.querySelector(".cross").style.display = "inline";
                    target.querySelector(".tick").style.display = "none";
                    playSound(incorrectAudio);
                    phrase.classList.remove("hidden");
                }
            }
        }

        function playSound(audio) {
            audio.currentTime = 0;  // Rewind the sound
            audio.play().catch(err => console.error("Audio playback error:", err));
        }

        function checkCompletion() {
            const pages = document.querySelectorAll(".quiz-container");
            const currentPageIndex = Array.from(pages).findIndex(page => !page.classList.contains("hidden"));
            const currentPage = pages[currentPageIndex];
            const dropzones = currentPage.querySelectorAll(".dropzone");
            const allMatched = Array.from(dropzones).every(zone => zone.querySelector("p"));

            if (allMatched) {
                if (currentPageIndex < pages.length - 2) {
                    currentPage.classList.add("hidden");
                    pages[currentPageIndex + 1].classList.remove("hidden");
                } else {
                    currentPage.classList.add("hidden");
                    document.getElementById("completion").classList.remove("hidden");
                    document.getElementById("quiz-heading").classList.add("hidden");

                    playSound(applauseAudio);  // Play applause sound when completing
                }
            }
        }

        function restartActivity() {
            document.getElementById("quiz-heading").classList.remove("hidden");
            document.getElementById("completion").classList.add("hidden");
            document.getElementById("page1").classList.remove("hidden");

            phrases.forEach(phrase => {
                phrase.style.display = "block";
                phrase.classList.remove("hidden");
            });

            dropzones.forEach(zone => {
                zone.querySelector("p")?.remove();
                zone.querySelector(".tick").style.display = "none";
                zone.querySelector(".cross").style.display = "none";
            });
        }
    });
</script>
